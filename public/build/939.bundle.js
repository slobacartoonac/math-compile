"use strict";(self.webpackChunktype_word=self.webpackChunktype_word||[]).push([[939],{939:(e,t,n)=>{function o(e){const t=(...t)=>{a.parentNode&&a.parentNode.removeChild(a),e.onclose&&e.onclose(),e.callback&&e.callback(...t)};let n=[];const o={onClick:e=>{e.stopPropagation(),e.preventDefault()},className:"modal_content"+(e.animate?" modal_animation":""),children:[{className:"modal_header",children:[...e.close?[{className:"close",text:"x",onClick:()=>t()}]:[],{tag:"h3",text:e.title||"&nbsp"}]},{className:"modal_body",children:[...e.message?[{tag:"p",text:e.message}]:[],...e.list?e.list.map((e=>({className:"modal_input",text:e.label||e,onClick:()=>t(e.id||e,n)}))):[],...e.inputs?e.inputs.map(((e,t)=>({tag:"input",type:"text",className:"modal_input",placeholder:e,onChange:e=>{n[t]=e}}))):[]]},{className:"modal_footer",children:e.options?e.options.map((e=>({className:"modal_button",text:e.label||e,onClick:()=>t(e.id||e,n)}))):[]}]},a=i({className:"modal noselect",removeIn:e.removeIn,callback:()=>t(),children:[o]});return a}function i(e){const t=document.createElement(e.tag||"div"),n=()=>{t.parentNode&&t.parentNode.removeChild(t),e.callback&&e.callback()};return e.text&&(t.innerHTML=e.text),e.style&&Object.entries(e.style).forEach((([e,n])=>{t.style[e]=n})),e.children&&e.children.forEach((e=>{t.appendChild(i(e))})),e.className&&(e.className,t.classList.add(...e.className.split(/\W/))),e.onClick&&(t.onclick=(...t)=>{e.remove&&n(),e.onClick(...t)}),e.onChange&&(t.onchange=t=>{e.onChange(t.target.value)}),e.removeIn&&setTimeout(n,e.removeIn),t}n.r(t),n.d(t,{FirebaseScoreStore:()=>v});var a=n(823),c=n(51),s=n(717),r=function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function c(e){try{r(o.next(e))}catch(e){a(e)}}function s(e){try{r(o.throw(e))}catch(e){a(e)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,s)}r((o=o.apply(e,t||[])).next())}))};function l(){return r(this,void 0,void 0,(function*(){const e=yield s.m;return(0,c.ad)(e)}))}function d(e){return new Promise(((t,n)=>{const o=(0,a.Aj)(e,(e=>{e?(o(),t(e.uid)):(o(),n("No user uid"))}))}))}function u(){return r(this,void 0,void 0,(function*(){const e=(0,a.v0)();try{return yield d(e)}catch(t){return console.log("Retry with login"),yield(0,a.XB)(e),yield d(e)}}))}function m(e){return r(this,void 0,void 0,(function*(){let t=yield u(),n=yield l(),o=(0,c.JU)(n,`users/${t}`);yield(0,c.pl)(o,{name:e,timestamp:+new Date})}))}function h(e){return r(this,void 0,void 0,(function*(){yield u();let t=yield l(),n=(0,c.JU)(t,`users/${e}`);return(yield(0,c.QT)(n)).data()}))}var p=n(345),f=function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function c(e){try{r(o.next(e))}catch(e){a(e)}}function s(e){try{r(o.throw(e))}catch(e){a(e)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,s)}r((o=o.apply(e,t||[])).next())}))},y=function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function c(e){try{r(o.next(e))}catch(e){a(e)}}function s(e){try{r(o.throw(e))}catch(e){a(e)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,s)}r((o=o.apply(e,t||[])).next())}))};class v{constructor(){this.maxScore=0,this.lastScore=0,this.leaders=[]}getHighScore(){return this.maxScore}getLeader(){return this.leaders}setUserName(){return y(this,void 0,void 0,(function*(){let e=yield function(){let e=document.getElementsByTagName("body")[0];return new Promise((t=>{const n=o({animate:!0,close:!0,inputs:["Nick"],message:"Do you want to set nick your nickname (please be nice)?",options:[{id:"anonimus",label:"Stay anonymous"},{id:"nick",label:"Set Nick"}],callback:(e,n)=>e?"nick"==e?t(n[0]||""):void t(""):t("")});n.addEventListener("mouseup",(e=>{e.stopPropagation(),e.preventDefault()}),!1),n.firstChild.style.zIndex="100",e.appendChild(n)}))}();e&&(yield m(e),this.fetch())}))}addScore(e){e>Math.min(0,...this.leaders.map((({score:e})=>e)))&&((()=>y(this,void 0,void 0,(function*(){try{let{name:e}=yield h(yield u())}catch(e){this.setUserName()}})))().then(),function(e,t){return f(this,void 0,void 0,(function*(){let t=yield u(),n=yield l(),o=(0,c.hJ)(n,"score_v"+p.i);yield(0,c.ET)(o,{score:e,uuid:t,timestamp:+new Date,version:""+p.i})}))}(e).then((()=>this.fetch())).then())}fetch(){return y(this,void 0,void 0,(function*(){try{this.leaders=yield function(){return f(this,void 0,void 0,(function*(){let e=yield l(),t=(0,c.hJ)(e,"score_v"+p.i),n=[(0,c.Xo)("score","desc"),(0,c.b9)(3)];const o=(0,c.IO)(t,...n),i=yield(0,c.PL)(o);let a=[];i.forEach((e=>{let{timestamp:t,uuid:n,score:o}=e.data();a.push({score:o,uuid:n,timestamp:t})}));let s=[];for(let e of a)try{const{score:t,uuid:n,timestamp:o}=e;let i=(yield h(n)).name;s.push({score:t,name:i,timestamp:o})}catch(t){const{score:n,timestamp:o}=e;let i="?";s.push({score:n,name:i,timestamp:o})}return s}))}();let e=this.leaders[0];e&&(this.maxScore=e.score)}catch(e){}}))}}},717:(e,t,n)=>{n.d(t,{m:()=>a});var o=n(977);const i={apiKey:"AIzaSyByvaSnLoD1-HDjopVLY-vCvcNXA9PYIj8",authDomain:"texttris.firebaseapp.com",projectId:"texttris",storageBucket:"texttris.appspot.com",messagingSenderId:"708579192075",appId:"1:708579192075:web:8dead5f668304fd8b9060e",measurementId:"G-L1WCPJGFDW"},a=new Promise((e=>{e((0,o.ZF)(i))}))}}]);